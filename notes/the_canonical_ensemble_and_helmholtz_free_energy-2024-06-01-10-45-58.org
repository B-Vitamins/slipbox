:PROPERTIES:
:ID:       b969d469-1e70-4ccf-beba-2c5405a01059
:END:
#+TITLE: The canonical ensemble and Helmholtz free energy
#+FILETAGS: :literature:spop:
#+SETUPFILE: ~/.config/emacs/setup/setupfile.org

In [[id:d0ef6177-22a7-45e9-a756-ee12186d4eef][the canonical ensemble]], the energy of a system S exchanging [[id:5211418e-55fa-4d7e-b2f5-88148f84cc76][heat]] with a reservoir R is a [[id:fa0e3aa2-347e-48b9-9cb7-e9f0be897281][random variable]]. We denote it using \(\mathcal{E}\). This is in contrast with [[id:170f5ef3-3995-4720-bbdb-c2ca704f0739][the microcanonical ensemble]] where the energy is fixed. The [[id:1adc2271-381b-4ee4-8b6c-f0401c0a08ea][probability density function]] \(p(\mathcal{E})\) is obtained by changing variables from \(\mu\) to \(H(\mu)\) in

\[
p_{(T,\,\mathbf{x})} (\mu) = \exp(-\beta H(\mu)) / Z(T, \mathbf{x}), \qquad Z(T, \mathbf{x})=\sum_{\{\mu\}} \exp(-\beta H(\mu))
\]
resulting in

\[
p_{(T,\,\mathbf{x})}(\mathcal{E})=\sum_{\{\mu\}} p_{(T,\,\mathbf{x})}(\mu) \delta(H(\mu)-\mathcal{E})=\frac{\exp(-\beta \mathcal{E})}{Z} \sum_{\{\mu\}} \delta(H(\mu)-\mathcal{E})
\]

Since the restricted sum is just the number \(\Omega(\mathcal{E})\) of microstates of appropriate energy

\[
p_{(T,\,\mathbf{x})}(\mathcal{E})=\frac{\Omega(\mathcal{E}) \exp(-\beta \mathcal{E})}{Z}=\frac{1}{Z} \exp \left[\frac{S(\mathcal{E})}{k_{B}}-\frac{\mathcal{E}}{k_{B} T}\right]=\frac{1}{Z} \exp \left[-\frac{(\mathcal{E} - T S (\mathcal{E}))}{k_{B} T}\right],
\]

where we have used [[id:954915f7-31f8-4910-8cab-116fead69656][Boltzmann's entropy formula]]. The probability \(p(\mathcal{E})\) is sharply peaked at a *most probable energy* \(E^{\ast}\), which minimizes \(\mathcal{E} - T S (\mathcal{E})\). Using the [[id:2baf3b2b-fd88-4b85-8485-8b944dcf2f4c][rules for large numbers]]

\[
Z=\sum_{\{\mu\}} \exp(-\beta H(\mu)) = \sum_{\mathcal{E}} \exp(-\beta (\mathcal{E} - T S (\mathcal{E}))) \approx \exp[-\beta (E^{\ast} - T S (E^{\ast}))], \tag{1}
\]

along with computing the *average energy* \( \langle H \rangle \) using \( p_{(T,\,\mathbf{x})}(\mathcal{E}) \)

\[
\langle H \rangle = \sum_{\mu} H(\mu) \frac{\exp(-\beta H(\mu))}{Z} = - \frac{1}{Z} \big( \partial_{\beta} \sum_{\mu} \exp(-\beta H) \big) = - \partial_{\beta} \ln Z \tag{2}
\]

suggests the identification

\[
F(T,\,\mathbf{x}) = -k_{B} T \ln Z (T,\,\mathbf{x}) \tag{3}
\]

where \(F = E - T S\) is the [[id:d45917b3-5147-49a3-9696-8eaf731026dd][Helmholtz free energy]]. However, note that (1) refers to the /most likely energy/, while (2) refers to the /average energy/. To determine if it is justified to treat the /average energy/ and the /most probable energy/ interchangeably, we could look at the width of the probability distribution \(p(\mathcal{E})\), by computing the variance \(\left\langle H^{2}\right\rangle_{c}\).

This is most easily accomplished by noting that \(Z(\beta)\) is related to the characteristic function for \(H\) (with \(\beta\) replacing \(ik\)) and

\[
-\frac{\partial Z}{\partial \beta}=\sum_{\mu} H \mathrm{e}^{-\beta H}, \quad \text { and } \quad \frac{\partial^{2} Z}{\partial \beta^{2}}=\sum_{\mu} H^{2} \mathrm{e}^{-\beta} H \tag{4}
\]

Cumulants of \(H\) are generated by \(\ln Z(\beta)\),

\[
\langle H \rangle_{c}=\frac{1}{Z} \sum_{\mu} H \mathrm{e}^{-\beta H}=-\frac{1}{Z} \frac{\partial Z}{\partial \beta}=-\frac{\partial \ln Z}{\partial \beta} \tag{5}
\]

and

\[
\langle H^{2} \rangle_{c}= \langle H^{2} \rangle - \langle H \rangle^{2} = \frac{1}{Z} \sum_{\mu} H^{2} \exp(-\beta H)-\frac{1}{Z^{2}} \left(\sum_{\mu} H \exp(-\beta H)\right)^{2} = \partial^{2}_{\beta} \ln Z = - \partial_{\beta} \langle H \rangle \tag{6}
\]

More generally, the \(n^{\text{th}}\) cumulant of \(H\) is given by

\[
\langle H^{n} \rangle_{c} = (-1)^{n} \partial^{n}_{\beta} \ln Z \tag{7}
\]

From (6)

\[
\langle H^{2} \rangle_{c} = - \partial_{\beta} \langle H \rangle = k_{B} T^{2} (\partial_{T} \langle H \rangle)_{\mathbf{x}}, \quad \Rightarrow \quad \langle H^{2} \rangle_{c} = k_{B} T^{2} C_{\mathbf{x}} \tag{8}
\]

where we have identified the [[id:7da7f949-a4cb-4953-8e91-00f359d37c9c][heat capacity]] with the thermal derivative of the average energy \(\langle H \rangle\).

Equation (8) shows that it is justified to treat the /average energy/ and the /most probable energy/ interchangeably, since the width of the distribution \(p(\mathcal{E})\) only grows as \(\sqrt{\langle H^{2} \rangle_{c}} \propto N^{1 / 2}\). The relative error, \(\sqrt{\langle H^{2} \rangle_{c}} /\langle H \rangle_{c}\), vanishes in the thermodynamic limit as \(1 / \sqrt{N}\). In fact, (7) shows that all cumulants of \(H\) are proportional to \(N\). The [[id:1adc2271-381b-4ee4-8b6c-f0401c0a08ea][probability density function]] for energy in [[id:d0ef6177-22a7-45e9-a756-ee12186d4eef][the canonical ensemble]] can thus be approximated by

\[
p(\mathcal{E})=\frac{1}{Z} \exp(-\beta F(\mathcal{E})) \approx \exp \left(-\frac{(\mathcal{E}-\langleH\rangle)^{2}}{2 k_{B} T^{2} C_{\mathbf{x}}}\right) \frac{1}{\sqrt{2 \pi k_{B} T^{2} C_{\mathbf{x}}}} .
\]

#+ATTR_HTML: :width 400px
[[file:~/.local/images/kardar-spop-4.8.jpg]]
#+CAPTION: The probability distribution of the internal energy for a system in a canonical ensemble at a temperature T.

The above distribution is sufficiently sharp to make the internal energy in a canonical ensemble unambiguous in the \(N \rightarrow \infty\) limit. Some care is necessary if the heat capacity \(C_{\mathrm{x}}\) is divergent, as is the case in some continuous phase transitions.